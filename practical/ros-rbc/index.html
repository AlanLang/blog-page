<!DOCTYPE html>
<html lang="en">

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <meta charset="utf-8">
  
<meta name="site" content="https:&#x2F;&#x2F;alanlang.me&#x2F;practical&#x2F;ros-rbc&#x2F;">
<meta name="keywords" content="å·¥å…·,ç¡¬ä»¶">
<meta name="description" content="">
<meta name="author" content="alanlang">
<meta http-equiv="x-dns-prefetch-control" content="on">
<!-- OG -->
<meta property="og:image" content="https:&#x2F;&#x2F;cdn.sa.net&#x2F;2024&#x2F;04&#x2F;14&#x2F;pmXThg2zd3tLcyr.jpg">
<meta property="og:description" content="">
<meta property="og:type" content="website">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="Alan&#x27;s Blog">
<meta property="og:url" content="https:&#x2F;&#x2F;alanlang.me&#x2F;practical&#x2F;ros-rbc&#x2F;">
<meta property="og:title" content="ROS æ­é… Clash å½»åº•æŠ›å¼ƒ OpenWrt - Alan&#x27;s Blog">
<meta property="twitter:partner" content="ogwp">
<!-- /OG -->
<!-- twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ROS æ­é… Clash å½»åº•æŠ›å¼ƒ OpenWrt - Alan&#x27;s Blog">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https:&#x2F;&#x2F;cdn.sa.net&#x2F;2024&#x2F;04&#x2F;14&#x2F;pmXThg2zd3tLcyr.jpg">
<!-- /twitter -->  

  <title>ROS æ­é… Clash å½»åº•æŠ›å¼ƒ OpenWrt - Alan&#x27;s Blog</title>
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">
  <link href="/assets/main.css" rel="stylesheet">
   
</head>

<body class="flex flex-col min-h-full">
  <nav class="flex justify-center items-center bg-zinc-700 py-2 " translate="no">
    <div class="inner flex justify-center items-center sm:justify-between flex-col sm:flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="https:&#x2F;&#x2F;alanlang.me">Alan&#x27;s Blog</a></li>
      </ul>
      <ul class="color-white flex flex-row gap-3 md:gap-4 items-center text-base">
        <li> <a class="nav-link hidden" href="https:&#x2F;&#x2F;alanlang.me/books"> Books </a> </li>
        <li> <a class="nav-link" href="https:&#x2F;&#x2F;alanlang.me/codes"> Codes </a> </li>
        <li> <a class="nav-link" href="https:&#x2F;&#x2F;alanlang.me/research"> Research </a> </li>
        <li> <a class="nav-link" href="https:&#x2F;&#x2F;alanlang.me/practical"> Practical </a> </li>
        <li> <a class="nav-link" href="https:&#x2F;&#x2F;alanlang.me/now"> Now </a> </li>
      </ul>
    </div>
  </nav>
  <div class="flex flex-col flex-grow">
    <div class="flex justify-center flex-grow min-h-[calc(100vh-15rem)]">
      <div class="inner mb-2">
        <div class="mt-4 lg:mt-6">
          
<h1 class="title font-medium text-2xl sm:text-3xl">
  <a href="https:&#x2F;&#x2F;alanlang.me&#x2F;practical&#x2F;ros-rbc&#x2F;">
      ROS æ­é… Clash å½»åº•æŠ›å¼ƒ OpenWrt
  </a>
</h1>
<div class="flex gap-4 items-center my-1">
 <time class="text-gray-500">2024-04-14</time>
</div>
<div class="prose lg:prose-xl max-w-full my-6">
  <p>ä¹‹å‰è‡ªå·±ä¸€ç›´åœ¨ç”¨ä¸»è·¯ç”±æ­é…æ—è·¯ç”±çš„æ–¹å¼ä½œä¸ºå®¶é‡Œçš„ç½‘ç»œæ¶æ„ï¼Œä¸»è·¯ç”±ä¸º MikroTik Routerosï¼Œæ—è·¯ç”±ä¸º OpenWrtã€‚ä¸»è·¯ç”±é€šè¿‡è®¾ç½® HDCP Options ç»™æœ‰éœ€æ±‚çš„è®¾å¤‡è‡ªåŠ¨æŠŠç½‘å…³å’Œ DNS æŒ‡å‘æ—è·¯ç”±ã€‚æœ€ç»ˆä½¿ç”¨ VRRP è§£å†³é«˜å¯ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢æ—è·¯ç”±ä¸‹çº¿æ—¶è¿™äº›è®¾å¤‡ç›´æ¥æ— æ³•ä¸Šç½‘ã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨ OpenWrt ä½œä¸ºæ—è·¯ç”±æœ‰å¾ˆå¤šä¸æ»¡æ„çš„åœ°æ–¹ï¼š</p>
<ol>
<li>OpenWrt ç³»ç»Ÿå¾ˆè‡ƒè‚¿ï¼Œå³ä½¿è‡ªå·±ç¼–è¯‘ç²¾ç®€äº†å¾ˆå¤šæ²¡ç”¨çš„åŒ…ï¼Œä½†æ˜¯ç”¨èµ·æ¥è¿˜æ˜¯å¡å¡çš„</li>
<li>OpenWrt ç³»ç»Ÿæ— æ³•å¹³æ»‘å®Œæˆç‰ˆæœ¬è¿­ä»£ï¼Œé¢‘ç¹å‡çº§å¯¼è‡´é‡è£…ç³»ç»Ÿå¾ˆéš¾å—</li>
<li>OpenClash ä¸å¥½ç”¨ï¼Œæ¯æ¬¡ä¿®æ”¹é…ç½®éƒ½è¦é‡å¯ï¼Œæ¯æ¬¡é‡å¯éƒ½å¥½ä¹…</li>
<li>ä¸€æ—¦æŠŠç½‘å…³æŒ‡å‘æ—è·¯ç”±ï¼Œè®¾å¤‡çš„æ‰€æœ‰æµé‡éƒ½ä¼šæŒ‡å‘æ—è·¯ç”±ï¼Œå¯¼è‡´å¸¸è§„æµé‡å˜æ…¢</li>
<li>æ—è·¯ç”±ç½‘å…³äº’æŒ‡å¯¼è‡´å¤šæ¬¡ natï¼Œæ€§èƒ½ä¸ä½³</li>
</ol>
<p>æ‰€ä»¥ä¸€ç›´æƒ³ç€å»æ‘’å¼ƒ OpenWrtï¼Œç›´åˆ°çœ‹åˆ°äº†ä¸€ä¸ªå¤§ç¥åšçš„ <a href="https://www.youtube.com/watch?v=eOr8yrp4KWk">YouTube</a> è§†é¢‘ï¼Œå‘ç°è¿™ç§æ–¹å¼å¾ˆé€‚åˆè‡ªå·±ï¼Œæ‰€ä»¥è¶ç€å‘¨æœ«çš„æ—¶é—´é‡æ–°æäº†ä¸€ä¸‹å®¶é‡Œçš„ç½‘ç»œã€‚</p>
<p><img src="https://cdn.sa.net/2024/04/14/8Fj2l61PheryuKA.webp" alt="image.png" /></p>
<p>ä¹‹å‰å®¶é‡Œä¸»è·¯ç”±è®¾å¤‡ç”¨çš„æ˜¯ MikroTik RB450Gx4ï¼Œè¿™æ¬¡è¶æœºä¹Ÿå‡çº§æˆäº† MikroTik RB5009 UPrï¼Œè¯¥è®¾å¤‡é™¤äº†æœ‰ä¸€ä¸ª 2.4G çš„ç½‘å£å’Œ 7 ä¸ªåƒå…†çš„ç½‘å£ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª SFP æ¥å£ï¼Œæ–¹ä¾¿ä»¥åç›´æ¥ä½¿ç”¨å…‰çŒ«ï¼Œè¿™æ¬¡å°±å…ˆä¸æŠ˜è…¾äº†ã€‚å¦å¤–è®¾å¤‡è¿˜æ”¯æŒ POE è¾“å‡ºï¼Œæ­£å¥½å¯ä»¥ç»™å®¶é‡Œçš„ AP è®¾å¤‡ä¾›ç”µã€‚è™½ç„¶å†…å­˜è¿˜æ˜¯ 1GB ä½†æ˜¯ CPU æå‡äº†å¾ˆå¤šï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæ¯”ä¹‹å‰é‚£ä¸ªå¼ºå¾ˆå¤šã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥æ­£å¼è®²ä¸€ä¸‹ä¸€ç§å…¨æ–°çš„åˆ†æµæ–¹å¼ï¼šRBC</p>
<h2 id="shi-yao-shi-rbc">ä»€ä¹ˆæ˜¯ RBC</h2>
<p>RBC å…¶å®å°±æ˜¯ Routeros + BGP + Clashï¼Œå³ä¸»è·¯ç”±ç³»ç»Ÿ + è¾¹ç•Œç½‘å…³åè®® + é€æ˜ç½‘å…³</p>
<p><img src="https://cdn.sa.net/2024/04/14/lrwxNCpz35oSXdm.webp" alt="image 1.png" /></p>
<p>æˆ‘ä»¬çš„åŸŸåä¼šé€šè¿‡ DNS è§£ææœåŠ¡å™¨è½¬æ¢ä¸º IP åœ°å€ï¼ŒROS åˆ™è´Ÿè´£åˆ¤æ–­ IP æ˜¯å¦å­˜åœ¨äºé™æ€è·¯ç”±è¡¨ï¼Œå¦‚æœå­˜åœ¨çš„è¯å®ƒå°±ä¼šèµ°é€æ˜ç½‘å…³ï¼ˆClashï¼‰ï¼Œä¸å­˜åœ¨çš„è¯å°±èµ°æˆ‘ä»¬çš„ä¸»è·¯ç”±ã€‚</p>
<p>ä¸ºäº†åšåˆ°ä¸Šè¿°çš„åˆ†æµæ–¹å¼ï¼Œæˆ‘ä»¬çš„ä¸»è¦å·¥ä½œå°±æ˜¯å®ç°ä¸Šå›¾ä¸­çš„å½©è‰²éƒ¨åˆ†ã€‚</p>
<h2 id="dns-jie-xi-fu-wu-qi">DNS è§£ææœåŠ¡å™¨</h2>
<p>è§†é¢‘é‡Œé¢ä½¿ç”¨çš„æ˜¯ easy mosdnsï¼Œè€Œæˆ‘è‡ªå·±åˆ™é€‰æ‹©ä½¿ç”¨ <a href="https://github.com/kkkgo/PaoPaoDNS">PaoPaoDNS</a>ï¼Œå¹¶ä¸æ˜¯åè€…ä¸€å®šæ¯”å‰è€…å¥½ç”¨ï¼Œåªæ˜¯è‡ªå·±éšä¾¿é€‰æ‹©äº†ä¸€ä¸ªã€‚</p>
<p>PaoPaoDNS çš„å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨ Docker å¯ä»¥å®‰è£…ï¼Œæˆ‘ä¸ªäººæ˜¯ä½¿ç”¨ PVE å•ç‹¬åˆ›å»ºäº†ä¸€å°è™šæ‹Ÿæœºï¼ŒDocker ä¼šç”¨ host ç½‘ç»œæ¨¡å¼å·²è·å¾—æœ€ä½³æ€§èƒ½ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code class="language-yaml" data-lang="yaml"><span style="color:#7f902a;">version</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;3&quot;

</span><span style="color:#7f902a;">services</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">paopaodns</span><span style="color:#1f1f1f;">:
    </span><span style="color:#7f902a;">image</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">sliamb/paopaodns:latest
    container_name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">PaoPaoDNS
    restart</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">always
    volumes</span><span style="color:#1f1f1f;">:
      - </span><span style="color:#7f902a;">./data:/data
    environment</span><span style="color:#1f1f1f;">:
      - </span><span style="color:#7f902a;">TZ=Asia/Shanghai
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">UPDATE=weekly
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">DNS_SERVERNAME=PaoPaoDNS,blog.03k.org
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">DNSPORT=53
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">SOCKS5=no
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">CNAUTO=yes
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">IPV6=no
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">CNFALL=yes
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">AUTO_FORWARD=no
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">CN_TRACKER=yes
      </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">SAFEMODE=no
    network_mode</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">host
</span></code></pre>
<p>DNS è§£ææœåŠ¡å™¨æˆ‘è®¾ç½®çš„ IP åœ°å€æ˜¯ <code>192.168.1.2</code></p>
<h2 id="tou-ming-wang-guan">é€æ˜ç½‘å…³</h2>
<p>é¦–å…ˆè®¾ç½®è½¬å‘</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">echo &#39;net.ipv4.ip_forward = 1&#39; | sudo tee -a /etc/sysctl.conf
echo &#39;net.ipv6.conf.all.forwarding = 1&#39; | sudo tee -a /etc/sysctl.conf
</span></code></pre>
<p>é€æ˜ç½‘å…³æˆ‘é€‰æ‹©ä½¿ç”¨çš„æ˜¯<a href="https://wiki.metacubex.one/">è™šç©ºç»ˆç«¯</a>ï¼Œç°åœ¨å¾ˆå¤šäººä¹Ÿå¼€å§‹æ¨è <a href="https://sing-box.sagernet.org/">sing-box</a> åç»­ä¹Ÿå¯ä»¥åˆ‡æ¢è¯•è¯•ã€‚</p>
<p>è™šç©ºç»ˆç«¯çš„å®‰è£…æ•™ç¨‹å®˜ç½‘å¾ˆè¯¦ç»†ï¼Œç…§ç€å®˜ç½‘å®‰è£…å°±è¡Œã€‚</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;"># ä¸‹è½½ï¼ˆæ³¨æ„ç‰ˆæœ¬ï¼‰
wget https://github.com/MetaCubeX/mihomo/releases/download/Prerelease-Alpha/mihomo-linux-amd64-compatible-alpha-df01582.gz

# è§£å‹ç¼©
gunzip mihomo-linux-amd64-compatible-alpha-df01582.gz

# é‡å‘½å
mv mihomo-linux-amd64-compatible-alpha-df01582 clash

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x clash

# ç§»åŠ¨åˆ° /usr/local/bin
mv clash /usr/local/bin

# åˆ›å»ºé…ç½®æ–‡ä»¶å¤¹
mkdir -p /etc/clash
</span></code></pre>
<p>é…ç½®æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ config.yaml</p>
<pre style="background-color:#f5f5f5;">
<code class="language-yaml" data-lang="yaml"><span style="color:#7f8989;">######### é”šç‚¹ start #######
# proxy ç›¸å…³
</span><span style="color:#7f902a;">pr</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">&amp;</span><span style="color:#c23f31;">pr </span><span style="color:#1f1f1f;">{</span><span style="color:#7f902a;">type</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">select</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">proxies</span><span style="color:#1f1f1f;">: [</span><span style="color:#d07711;">é»˜è®¤</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">é¦™æ¸¯</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">å°æ¹¾</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">æ—¥æœ¬</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">æ–°åŠ å¡</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">ç¾å›½</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">å…¶å®ƒåœ°åŒº</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">å…¨éƒ¨èŠ‚ç‚¹</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">è‡ªåŠ¨é€‰æ‹©</span><span style="color:#1f1f1f;">,</span><span style="color:#d07711;">DIRECT</span><span style="color:#1f1f1f;">]}

</span><span style="color:#7f8989;">#è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
</span><span style="color:#7f902a;">p</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">&amp;</span><span style="color:#c23f31;">p </span><span style="color:#1f1f1f;">{</span><span style="color:#7f902a;">type</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">http</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">interval</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">3600</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">health-check</span><span style="color:#1f1f1f;">: {</span><span style="color:#7f902a;">enable</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">url</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">http://www.google.com/generate_204</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">interval</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">300</span><span style="color:#1f1f1f;">}}

</span><span style="color:#7f902a;">use</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">&amp;</span><span style="color:#c23f31;">use
  </span><span style="color:#7f902a;">type</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">select
  use</span><span style="color:#1f1f1f;">:
  - </span><span style="color:#d07711;">provider1

</span><span style="color:#7f8989;">######### é”šç‚¹ end #######


# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
</span><span style="color:#7f902a;">proxy-providers</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">provider1</span><span style="color:#1f1f1f;">:
    </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">p
    </span><span style="color:#7f902a;">url</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;&quot;

</span><span style="color:#7f902a;">mode</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">rule
ipv6</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">false
</span><span style="color:#7f902a;">log-level</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">info
allow-lan</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
</span><span style="color:#7f902a;">mixed-port</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">7890
</span><span style="color:#7f902a;">unified-delay</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">false
</span><span style="color:#7f902a;">tcp-concurrent</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
</span><span style="color:#7f902a;">external-controller</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">0.0.0.0:9090
secret</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&#39;123456789&#39;

</span><span style="color:#7f902a;">geodata-mode</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
</span><span style="color:#7f902a;">geox-url</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">geoip</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat&quot;
  </span><span style="color:#7f902a;">geosite</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat&quot;
  </span><span style="color:#7f902a;">mmdb</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb&quot;

</span><span style="color:#7f902a;">profile</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">store-selected</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">store-fake-ip</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">tracing</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true

</span><span style="color:#7f902a;">sniffer</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">enable</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">sniff</span><span style="color:#1f1f1f;">:
    </span><span style="color:#7f902a;">TLS</span><span style="color:#1f1f1f;">:
      </span><span style="color:#7f902a;">ports</span><span style="color:#1f1f1f;">: [</span><span style="color:#b3933a;">443</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">8443</span><span style="color:#1f1f1f;">]
    </span><span style="color:#7f902a;">HTTP</span><span style="color:#1f1f1f;">:
      </span><span style="color:#7f902a;">ports</span><span style="color:#1f1f1f;">: [</span><span style="color:#b3933a;">80</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">8080-8880</span><span style="color:#1f1f1f;">]
      </span><span style="color:#7f902a;">override-destination</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
</span><span style="color:#7f902a;">interface-name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">eth0
tun</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">device</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">utun
  enable</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">stack</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">system
  auto-route</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">auto-detect-interface</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">false

</span><span style="color:#7f902a;">dns</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">enable</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">true
  </span><span style="color:#7f902a;">listen</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">:1053
  ipv6</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">false
  </span><span style="color:#7f902a;">enhanced-mode</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">redir-host
  fake-ip-range</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">28.0.0.1/8
  fake-ip-filter</span><span style="color:#1f1f1f;">:
    - </span><span style="color:#d07711;">&#39;*&#39;
    </span><span style="color:#1f1f1f;">- </span><span style="color:#d07711;">&#39;+.lan&#39;
    </span><span style="color:#1f1f1f;">- </span><span style="color:#d07711;">&#39;+.local&#39;
  </span><span style="color:#7f902a;">default-nameserver</span><span style="color:#1f1f1f;">:
    - </span><span style="color:#b3933a;">192.168.1.2
  </span><span style="color:#7f902a;">nameserver</span><span style="color:#1f1f1f;">:
    - </span><span style="color:#b3933a;">192.168.1.2
  </span><span style="color:#7f902a;">proxy-server-nameserver</span><span style="color:#1f1f1f;">:
    - </span><span style="color:#b3933a;">192.168.1.2
  </span><span style="color:#7f902a;">nameserver-policy</span><span style="color:#1f1f1f;">:
    </span><span style="color:#d07711;">&quot;geosite:cn,private&quot;</span><span style="color:#1f1f1f;">:
      - </span><span style="color:#b3933a;">192.168.1.2

</span><span style="color:#7f902a;">proxies</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f8989;"># - name: &quot;WARP&quot;
  #   type: wireguard
  #   server: engage.cloudflareclient.com
  #   port: 2408
  #   ip: &quot;172.16.0.2/32&quot;
  #   ipv6: &quot;2606::1/128&quot;        # è‡ªè¡Œæ›¿æ¢
  #   private-key: &quot;private-key&quot; # è‡ªè¡Œæ›¿æ¢
  #   public-key: &quot;public-key&quot;   # è‡ªè¡Œæ›¿æ¢
  #   udp: true
  #   reserved: &quot;abba&quot;           # è‡ªè¡Œæ›¿æ¢
  #   mtu: 1280
  #   dialer-proxy: &quot;dns&quot;
  #   remote-dns-resolve: true
  #   dns:
  #     - https://dns.cloudflare.com/dns-query

</span><span style="color:#7f902a;">proxy-groups</span><span style="color:#1f1f1f;">:

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">é»˜è®¤</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">type</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">select</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">proxies</span><span style="color:#1f1f1f;">: [</span><span style="color:#d07711;">DIRECT</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">é¦™æ¸¯</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">å°æ¹¾</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">æ—¥æœ¬</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">æ–°åŠ å¡</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">ç¾å›½</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">å…¶å®ƒåœ°åŒº</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">å…¨éƒ¨èŠ‚ç‚¹</span><span style="color:#1f1f1f;">, </span><span style="color:#d07711;">è‡ªåŠ¨é€‰æ‹©</span><span style="color:#1f1f1f;">]}
</span><span style="color:#7f8989;"># - {name: dns, type: select, proxies: [DIRECT, WARP, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©]}  # åŠ å…¥ WARP  
#åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  </span><span style="color:#1f1f1f;">- {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">é¦™æ¸¯</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">,</span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)æ¸¯|hk|hongkong|hong kong&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">å°æ¹¾</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)å°|tw|taiwan&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">æ—¥æœ¬</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)æ—¥æœ¬|jp|japan&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">ç¾å›½</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)ç¾|us|unitedstates|united states&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">æ–°åŠ å¡</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)(æ–°|sg|singapore)&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">å…¶å®ƒåœ°åŒº</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">filter</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">&quot;(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*&quot;</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">å…¨éƒ¨èŠ‚ç‚¹</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">}

  - {</span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">è‡ªåŠ¨é€‰æ‹©</span><span style="color:#1f1f1f;">, </span><span style="color:#b3933a;">&lt;&lt;</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">*</span><span style="color:#5597d6;">use</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">tolerance</span><span style="color:#1f1f1f;">: </span><span style="color:#b3933a;">2</span><span style="color:#1f1f1f;">, </span><span style="color:#7f902a;">type</span><span style="color:#1f1f1f;">: </span><span style="color:#d07711;">url-test</span><span style="color:#1f1f1f;">}

</span><span style="color:#7f902a;">rules</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f8989;"># - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT # quic

  </span><span style="color:#1f1f1f;">- </span><span style="color:#d07711;">MATCH,é»˜è®¤
</span></code></pre>
<p>é‡Œé¢æœ‰å‡ ä¸ªé…ç½®éœ€è¦æ³¨æ„ä¸€ä¸‹</p>
<ul>
<li>provider1 url å¡«å…¥è‡ªå·±çš„è®¢é˜…åœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜…å¯ä»¥è‡ªå·±åŠ  provider</li>
<li>dns é‡Œçš„åœ°å€æ›¿æ¢æˆè‡ªå·± DNS è§£ææœåŠ¡å™¨çš„åœ°å€</li>
<li>interface-name è®¾ç½®ä¸ºè‡ªå·±ç½‘å¡çš„åç§°</li>
<li>tun çš„ device åç§°ä¸º utun</li>
</ul>
<p>ç»§ç»­æŠŠé€æ˜ç½‘å…³æ³¨å†Œä¸ºç³»ç»ŸæœåŠ¡å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">sudo tee /etc/systemd/system/clash.service &gt; /dev/null &lt;&lt;EOF
[Unit]
Description=Clash daemon, A rule-based proxy in Go.
After=network.target

[Service]
Type=simple
Restart=always
ExecStart=/usr/local/bin/clash -d /etc/clash

[Install]
WantedBy=multi-user.target
EOF

systemctl enable clash
</span></code></pre>
<p>é€æ˜ç½‘å…³æˆ‘è®¾ç½®çš„ IP åœ°å€ä¸º <code>192.168.1.6</code></p>
<h2 id="jing-tai-lu-you-biao">é™æ€è·¯ç”±è¡¨</h2>
<p>é™æ€è·¯ç”±è¡¨ä½¿ç”¨ nchnroutes é¡¹ç›®å®ç°ï¼Œæ¯å¤© 5 ç‚¹è‡ªåŠ¨ç”Ÿæˆæœ€æ–°è·¯ç”±è¡¨å¹¶é€šè¿‡ BGP ä¼ é€’ç»™ ROSã€‚</p>
<p>å®‰è£… bird2</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">apt update
apt install bird2 -y
</span></code></pre>
<p>éæœ¬åœ° ip è¡¨è·å–</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">
# ä¸‹è½½ ip è¡¨
wget https://raw.githubusercontent.com/haotianlPM/rosrbgprouter/main/iplist.sh
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x iplist.sh
# æ‰§è¡Œä¸€æ¬¡
./iplist.sh

# é…ç½®å®šæ—¶æ‰§è¡Œ
crontab -e
0 5 * * * /bin/bash /home/iplist.sh
</span></code></pre>
<p>é…ç½® bird2</p>
<p>ä¿®æ”¹ <code>bird2</code> é…ç½®æ–‡ä»¶ä¸ºä»¥ä¸‹å†…å®¹ ï¼Œæ–‡ä»¶åœ¨ <code>/etc/bird/bird.conf</code></p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">
log syslog all;

router id 192.168.1.6;

protocol device {
    scan time 60;
}

protocol kernel {
    ipv4 {
        import none;
        export all;
    };
}

protocol static {
    ipv4 {};
    include &quot;routes4.conf&quot;;
}

protocol bgp {
    local as 65531;
    neighbor 192.168.1.1 as 65530;
    source address 192.168.1.6;
    ipv4 {
        import none;
        export all;
    };
}
</span></code></pre>
<p>æ³¨æ„ä¿®æ”¹ä¸Šè¿°çš„ IP åœ°å€ã€‚<code>192.168.1.6</code> ä¸ºé€æ˜ç½‘å…³çš„åœ°å€ï¼Œ<code>192.168.1.1</code> ä¸º ROS è·¯ç”±å™¨çš„åœ°å€ã€‚</p>
<p>æŸ¥çœ‹ bird æ‰§è¡ŒçŠ¶æ€</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">systemctl status bird
</span></code></pre><h2 id="she-zhi-ros">è®¾ç½® ROS</h2>
<p>ROS åˆ†æµæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ‰€æœ‰è®¾å¤‡éƒ½å¯ä»¥åˆ†æµï¼Œå¦ä¸€ç§æ˜¯å¯ä»¥æŒ‡å®šè®¾å¤‡è¿›è¡Œåˆ†æµï¼Œè¿™è¾¹æˆ‘æ¨èåè€…ã€‚</p>
<p>é¦–å…ˆåœ¨ ROS åˆ›å»ºä¸€ä¸ªè·¯ç”±è¡¨ï¼ŒRouting â†’ Tablesï¼Œåå­—ä¸º <code>bypass</code>ï¼Œä¸”å‹¾é€‰ FIBã€‚</p>
<p>ç„¶åæ‰“å¼€ ROS çš„ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;"># æ·»åŠ ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œè·ç¦»ä¸º1ï¼Œç½‘å…³ä¸ºpppoe-out1ï¼Œè·¯ç”±è¡¨ä¸ºbypassï¼Œæ³¨é‡Šä¸ºpass
/ip route
add distance=1 gateway=pppoe-out1 routing-table=bypass comment=pass

# æ·»åŠ ä¸€ä¸ªBGPè¿æ¥ï¼Œåç§°ä¸ºclashï¼Œæœ¬åœ°è§’è‰²ä¸ºebgpï¼Œè¿œç¨‹åœ°å€ä¸º192.168.1.6ï¼Œè‡ªæ²»ç³»ç»Ÿå·ä¸º65531ï¼Œè·¯ç”±è¡¨ä¸ºbypassï¼Œè·¯ç”±å™¨IDä¸º192.168.1.1ï¼Œè‡ªæ²»ç³»ç»Ÿå·ä¸º65530ï¼Œå¯ç”¨å¤šè·³é€‰é¡¹
/routing/bgp/connection
add name=clash local.role=ebgp remote.address=192.168.1.6 .as=65531 routing-table=bypass router-id=192.168.1.1 as=65530 multihop=yes

# æ·»åŠ ä¸€ä¸ªé˜²ç«å¢™Mangleè§„åˆ™ï¼ŒåŠ¨ä½œä¸ºæ¥å—ï¼Œé“¾ä¸ºpreroutingï¼Œæºåœ°å€ä¸º192.168.1.6
/ip firewall mangle add action=accept chain=prerouting src-address=192.168.1.6
</span></code></pre>
<p>æ³¨æ„æˆ‘çš„ç½‘å…³åç§°ä¸º <code>pppoe-out1</code>ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…è®¾ç½®ä¿®æ”¹åç§°ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™åœ¨ ROS çš„ IP â†’ Routes é‡Œé¢å°±å¯ä»¥çœ‹åˆ°ä¼ è¿‡æ¥çš„ä¸€å¤§å † ip åœ°å€äº†</p>
<p><img src="https://cdn.sa.net/2024/04/14/mAgqcY6SPwXT25e.webp" alt="image 2.png" /></p>
<p>å‡è®¾æˆ‘æœ‰ä¸€ä¸ª ip ä¸º <code>192.168.1.100</code> çš„è®¾å¤‡æƒ³èµ°åˆ†æµï¼Œåˆ™éœ€è¦ç»§ç»­è®¾ç½®ï¼š</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;"># æ·»åŠ ä¸€ä¸ªåœ°å€åˆ—è¡¨ï¼Œåç§°ä¸ºproxyï¼ŒåŒ…å«åœ°å€ 192.168.1.100
/ip firewall address-list add list=proxy address=192.168.1.100

# æ·»åŠ ä¸€ä¸ªé˜²ç«å¢™Mangleè§„åˆ™ï¼ŒåŠ¨ä½œä¸ºæ ‡è®°è·¯ç”±ï¼Œé“¾ä¸ºpreroutingï¼Œæºåœ°å€åˆ—è¡¨ä¸ºproxyï¼Œè¿æ¥ç±»å‹tcpã€‚ç›®æ ‡ç«¯å£ä¸º80å’Œ443ï¼Œç›®æ ‡åœ°å€ç±»å‹ä¸æ˜¯æœ¬åœ°åœ°å€ï¼Œæ–°çš„è·¯ç”±æ ‡è®°ä¸ºbypass
/ip firewall mangle add action=mark-routing chain=prerouting src-address-list=proxy dst-port=80,443 dst-address-type=!local protocol=tcp new-routing-mark=bypass
</span></code></pre>
<p>è¿™æ˜¯ <code>192.168.1.100</code> çš„è®¾å¤‡å°±å·²ç»å¯ä»¥æˆåŠŸåˆ†æµäº†ã€‚</p>
<p>å¦‚æœæƒ³ç»§ç»­æ·»åŠ å…¶ä»–åˆ†æµè®¾å¤‡ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œï¼š</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;"># æ·»åŠ ä¸€ä¸ªåœ°å€åˆ—è¡¨ï¼Œåç§°ä¸ºproxyï¼ŒåŒ…å«åœ°å€ 192.168.1.101
/ip firewall address-list add list=proxy address=192.168.1.101
</span></code></pre>
<p>æˆ–è€…ç›´æ¥é€šè¿‡å¯è§†åŒ–ç•Œé¢è¿›è¡Œæ·»åŠ ï¼Œåœ¨ IP â†’ Firewallï¼Œé€‰æ‹© Address Lists é€‰é¡¹å¡ï¼Œè¿™ä¸ªæ—¶å€™èƒ½çœ‹åˆ°æˆ‘ä»¬å·²ç»æ·»åŠ è¿‡çš„ IPï¼Œè¿™ä¸ªæ—¶å€™ç»§ç»­æ·»åŠ å°±è¡Œäº†ã€‚</p>
<h2 id="qi-jian-yu-dao-de-yi-xie-wen-ti">æœŸé—´é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2>
<h3 id="ip-biao-wu-fa-tong-bu-dao-ros-li">IP è¡¨æ— æ³•åŒæ­¥åˆ° ROS é‡Œ</h3>
<p>å½“æ—¶å®šä½è¿™ä¸ªé—®é¢˜ç”šè‡³èŠ±è´¹äº† 1 å¤©çš„æ—¶å€™ï¼ŒRouting â†’ BGP â†’ Sessions é‡Œé¢èƒ½æ­£å¸¸çœ‹åˆ°è®¾å¤‡ï¼Œbird æ‰§è¡Œ <code>birdc show protocols</code> ä¹Ÿæ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯ ROS é‡Œå°±æ˜¯çœ‹ä¸åˆ°åŒæ­¥çš„æ•°æ®ï¼Œæœ€ç»ˆæ‰å‘ç°æ˜¯æˆ‘ clash çš„é…ç½®é‡Œ tun çš„è®¾å¤‡åå­—ä¸å« utun å¯¼è‡´çš„ï¼Œè€Œä¸‹è½½çš„ ip è¡¨æ˜¯å†™çš„ä¸‹ä¸€è·³æ˜¯ utunï¼Œè€Œæ‰¾ä¸åˆ°è®¾å¤‡å¯¼è‡´æ— æ³•åŒæ­¥ã€‚</p>
<h2 id="shi-xian-gao-ke-yong">å®ç°é«˜å¯ç”¨</h2>
<p>å‚è€ƒ<a href="https://idndx.com/high-availability-when-split-routing-using-routeros-and-raspberrypi/">è¿™ç¯‡æ–‡ç« </a>ï¼Œæ•´ä¸ªç³»ç»Ÿåˆ›å»ºå¥½åï¼Œå¸¦æ¥çš„é—®é¢˜å°±æ˜¯ DNS è§£ææœåŠ¡å™¨çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬æ‰€æœ‰çš„è®¾å¤‡éƒ½ä¼šèµ° DNS è§£ææœåŠ¡å™¨ï¼Œä¸€æ—¦ DNS æŒ‚äº†å¤§å®¶å°±éƒ½ä¸èƒ½ä¸Šç½‘äº†ï¼Œæ‰€ä»¥éœ€è¦å®ç°æ•…éšœæ£€æµ‹åŠŸèƒ½ï¼Œå½“ DNS æœåŠ¡å™¨æŒ‚äº†éœ€è¦è‡ªåŠ¨åˆ‡æ¢åˆ° ROS è‡ªå·±çš„ DNS æœåŠ¡ã€‚</p>
<p>å…·ä½“çš„åšæ³•å°±æ˜¯åˆ›å»ºä¸¤æ¡è„šæœ¬ï¼Œä¸€æ¡åˆ‡æ¢ DNS åœ°å€ä¸º <code>192.168.1.2</code>ï¼Œå¦ä¸€æ¡åˆ‡æ¢ä¸ºè¿è¥å•†çš„é€’å½’ DNS åœ°å€ï¼Œæ¯”å¦‚ <code>114.114.114.114</code></p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">/system/script
add dont-require-permissions=yes name=use-paopao-dns source=\
&quot;/ip/dns/set servers=192.168.0.2\
\n/ip/dns/cache/flush&quot;
add dont-require-permissions=yes name=use-ct-dns source=\
&quot;/ip/dns/set servers=114.114.114.114\
\n/ip/dns/cache/flush
</span></code></pre>
<p>è¿™é‡Œçš„ <code>dont-require-permissions=yes</code> æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ <a href="https://wiki.mikrotik.com/wiki/Manual:Tools/Netwatch?ref=idndx.com">Netwatch</a> æ‰§è¡Œçš„æ—¶å€™ä¼šæŠ¥æƒé™é”™è¯¯ã€‚</p>
<p>ç„¶åé…ç½® Netwatch æ¥æ£€æµ‹ DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œå¦‚æœå®•æœºå°±è‡ªå®šæ‰§è¡Œè„šæœ¬åˆ‡æ¢ DNSã€‚</p>
<pre style="background-color:#f5f5f5;">
<code class="language-shell" data-lang="shell"><span style="color:#1f1f1f;">/tool/netwatch
add down-script=use-ct-dns host=192.168.1.2 interval=30s up-script=use-paopao-dns
</span></code></pre><h2 id="te-bie-gan-xie-yi-xia-jiao-cheng">ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹æ•™ç¨‹</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=eOr8yrp4KWk">ROSæ­é…Clashï¼Œå½»åº•æŠ›å¼ƒopenwrtï¼Œé…åˆæ— æ±¡æŸ“DNSè¿›è¡ŒIPåˆ†æµ</a></li>
<li><a href="https://idndx.com/high-availability-when-split-routing-using-routeros-and-raspberrypi/">RouterOS å›½å†…å¤–åˆ†æµç¯å¢ƒä¸‹çš„ç½‘ç»œé«˜å¯ç”¨æ€§è®¾è®¡</a></li>
</ul>

</div>



<div class="fixed flex-col top-0 bottom-0 right-0 left-[calc((100%-48rem)/2+50rem)] items-center justify-center hidden xl:flex">
  <nav class="docs-toc flex select-none items-center justify-center">
    <nav>
      <ul>
        
        <li><a data-id="shi-yao-shi-rbc" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#shi-yao-shi-rbc">ä»€ä¹ˆæ˜¯ RBC</a></li>
        
        
        <li><a data-id="dns-jie-xi-fu-wu-qi" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#dns-jie-xi-fu-wu-qi">DNS è§£ææœåŠ¡å™¨</a></li>
        
        
        <li><a data-id="tou-ming-wang-guan" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#tou-ming-wang-guan">é€æ˜ç½‘å…³</a></li>
        
        
        <li><a data-id="jing-tai-lu-you-biao" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#jing-tai-lu-you-biao">é™æ€è·¯ç”±è¡¨</a></li>
        
        
        <li><a data-id="she-zhi-ros" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#she-zhi-ros">è®¾ç½® ROS</a></li>
        
        
        <li><a data-id="qi-jian-yu-dao-de-yi-xie-wen-ti" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#qi-jian-yu-dao-de-yi-xie-wen-ti">æœŸé—´é‡åˆ°çš„ä¸€äº›é—®é¢˜</a></li>
        
        <ul>
          
          <li><a data-id="ip-biao-wu-fa-tong-bu-dao-ros-li" class="docs-toc-item text-xs ml-2 opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#ip-biao-wu-fa-tong-bu-dao-ros-li">IP è¡¨æ— æ³•åŒæ­¥åˆ° ROS é‡Œ</a></li>
          
        </ul>
        
        
        <li><a data-id="shi-xian-gao-ke-yong" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#shi-xian-gao-ke-yong">å®ç°é«˜å¯ç”¨</a></li>
        
        
        <li><a data-id="te-bie-gan-xie-yi-xia-jiao-cheng" class="docs-toc-item text-xs opacity-50 transition-opacity duration-300" href="https://alanlang.me/practical/ros-rbc/#te-bie-gan-xie-yi-xia-jiao-cheng">ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹æ•™ç¨‹</a></li>
        
        
      </ul>
    </nav>
  </nav>
</div>


        </div>
      </div>
    </div>
    
<div class="mt-4 mb-6 flex flex-row items-center justify-center">
  <svg id="loading" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; display: block;" width="34px" height="34px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
    <defs>
      <clipPath id="ldio-h4a348o36ew-cp">
        <rect x="0" y="0" width="100" height="50">
          <animate attributeName="y" repeatCount="indefinite" dur="2.2222222222222223s" calcMode="spline" values="0;50;0;0;0" keyTimes="0;0.4;0.5;0.9;1" keySplines="0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7"></animate>
          <animate attributeName="height" repeatCount="indefinite" dur="2.2222222222222223s" calcMode="spline" values="50;0;0;50;50" keyTimes="0;0.4;0.5;0.9;1" keySplines="0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7"></animate>
        </rect>
        <rect x="0" y="50" width="100" height="50">
          <animate attributeName="y" repeatCount="indefinite" dur="2.2222222222222223s" calcMode="spline" values="100;50;50;50;50" keyTimes="0;0.4;0.5;0.9;1" keySplines="0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7"></animate>
          <animate attributeName="height" repeatCount="indefinite" dur="2.2222222222222223s" calcMode="spline" values="0;50;50;0;0" keyTimes="0;0.4;0.5;0.9;1" keySplines="0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7;0.3 0 1 0.7"></animate>
        </rect>
      </clipPath>
    </defs>
    <g transform="translate(50 50)"><g transform="scale(0.9)"><g transform="translate(-50 -50)">
      <g>
        <animateTransform attributeName="transform" type="rotate" dur="2.2222222222222223s" repeatCount="indefinite" values="0 50 50;0 50 50;180 50 50;180 50 50;360 50 50" keyTimes="0;0.4;0.5;0.9;1"></animateTransform>
        <path clip-path="url(#ldio-h4a348o36ew-cp)" fill="#5699d2" d="M54.864 50L54.864 50c0-1.291 0.689-2.412 1.671-2.729c9.624-3.107 17.154-12.911 19.347-25.296 c0.681-3.844-1.698-7.475-4.791-7.475H28.908c-3.093 0-5.472 3.631-4.791 7.475c2.194 12.385 9.723 22.189 19.347 25.296 c0.982 0.317 1.671 1.438 1.671 2.729v0c0 1.291-0.689 2.412-1.671 2.729C33.84 55.836 26.311 65.64 24.117 78.025 c-0.681 3.844 1.698 7.475 4.791 7.475h42.184c3.093 0 5.472-3.631 4.791-7.475C73.689 65.64 66.16 55.836 56.536 52.729 C55.553 52.412 54.864 51.291 54.864 50z"></path>
        <path fill="#1d3f72" d="M81 81.5h-2.724l0.091-0.578c0.178-1.122 0.17-2.243-0.022-3.333C76.013 64.42 68.103 54.033 57.703 50.483l-0.339-0.116 v-0.715l0.339-0.135c10.399-3.552 18.31-13.938 20.642-27.107c0.192-1.089 0.2-2.211 0.022-3.333L78.276 18.5H81 c2.481 0 4.5-2.019 4.5-4.5S83.481 9.5 81 9.5H19c-2.481 0-4.5 2.019-4.5 4.5s2.019 4.5 4.5 4.5h2.724l-0.092 0.578 c-0.178 1.122-0.17 2.243 0.023 3.333c2.333 13.168 10.242 23.555 20.642 27.107l0.338 0.116v0.715l-0.338 0.135 c-10.4 3.551-18.31 13.938-20.642 27.106c-0.193 1.09-0.201 2.211-0.023 3.333l0.092 0.578H19c-2.481 0-4.5 2.019-4.5 4.5 s2.019 4.5 4.5 4.5h62c2.481 0 4.5-2.019 4.5-4.5S83.481 81.5 81 81.5z M73.14 81.191L73.012 81.5H26.988l-0.128-0.309 c-0.244-0.588-0.491-1.538-0.28-2.729c2.014-11.375 8.944-20.542 17.654-23.354c2.035-0.658 3.402-2.711 3.402-5.108 c0-2.398-1.368-4.451-3.403-5.108c-8.71-2.812-15.639-11.979-17.653-23.353c-0.211-1.191 0.036-2.143 0.281-2.731l0.128-0.308 h46.024l0.128 0.308c0.244 0.589 0.492 1.541 0.281 2.731c-2.015 11.375-8.944 20.541-17.654 23.353 c-2.035 0.658-3.402 2.71-3.402 5.108c0 2.397 1.368 4.45 3.403 5.108c8.71 2.812 15.64 11.979 17.653 23.354 C73.632 79.651 73.384 80.604 73.14 81.191z"></path>
      </g>
    </g></g></g>
  </svg>
  <div id="like-btn" class="text-gray-400 hidden rounded-full border border-gray-300 p-1 px-3 flex flex-row items-center gap-2 cursor-pointer disabled">
    <p> ğŸ‘ </p>
    <p class="text-sm hidden" id="like-count" style="display: block;"></p>
  </div>
</div>


    <footer class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center text-sm mt-1" translate="no">
      <div class="flex flex-col inner justify-center items-center gap-2 pt-6 pb-4">
        <p> Be curious. Read widely. Try new things. -- Aaron Swartz </p>
        <p> alanlang.me@gmail.com </p>
        <ul>
          <li class="flex flex-row gap-2">
            <a class="underline" href="https:&#x2F;&#x2F;alanlang.me/archives">Archives</a>
            <a class="underline" href="https:&#x2F;&#x2F;alanlang.me/categories">Categories</a>
            <a class="underline" href="https:&#x2F;&#x2F;alanlang.me/tags">Tags</a>
          </li>
        </ul>
        <p><a class="underline" href="https:&#x2F;&#x2F;alanlang.me/atom.xml">RSS</a></p>
        <p>2022 - Present</p>
      </div>
    </footer>
  </div>
  
<script defer type="text/javascript" src="/assets/main.js"></script>

</body>

</html>
